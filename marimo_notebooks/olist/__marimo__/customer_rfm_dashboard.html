<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          // Guard against race condition where iframe isn't ready
          if (!obj.contentWindow?.document?.documentElement) {
            return;
          }
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        // Only observe if iframe content is ready
        if (obj.contentWindow?.document?.body) {
          resizeObserver.observe(obj.contentWindow.document.body);
        }
      }
    </script>
    <marimo-filename hidden>customer_rfm_dashboard.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>customer rfm dashboard</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/index-BXqkmYCF.js"></script>
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/preload-helper-BnutJmlU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/chunk-DZLz74EQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/react-BcIddLXZ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/compiler-runtime-Cr9loedd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/jsx-runtime-mwDPpfh_.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useEventListener-D1FLsfmf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/react-dom-D6bRRS5R.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Combination-BjaZc6gK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/clsx-BlAkgCmw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cn-ZXtYmczU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/menu-items-DwOFR2Zi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/hotkeys-ClCtr3_I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/button-ZC2axIBq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-o-4-WxUj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/createLucideIcon-CNVopWor.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/check-CuBLr6Cm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/select-5fcaZwou.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/multi-map-D9JaQ_m6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/chevron-right-BV0VfNbL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dropdown-menu-uN_XMhZm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/tooltip-BHnVWzH0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_Uint8Array-D5Z9rM2X.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_getTag-CVRrQL_Q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseIsEqual-CVFfFJm2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/jotai-BTnrNcC1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/invariant-D5a0EE05.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/isArrayLikeObject-DKyJYtr8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/merge-Dvc5opZF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/zod-U2NFpcFA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/utils-DEDX0RLo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/requests-BACZP_uj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/once-C5bmD4W5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toDate-C3oOx2yr.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseSlice-BWZ0PeaJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_arrayMap-DQI2GUNb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/isSymbol-xTSywenE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toString-CBnct2wx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_hasUnicode-3DIK_jNi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/upperFirst-CBQfDRod.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/capitalize-CBqvgOfA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ai-model-dropdown-CvhbTHha.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/badge-Jfhpc30N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/use-toast-midBZAtS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/constants-CEISdYm1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Deferred-NfAvvkGM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/config-C6qInAhC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/uuid-D0hUC3Qw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/key-Cx1qY8eM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/connection-Bs4SQ_vu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useLifecycle-DogGOXPh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useNonce-VIoWEX5z.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/capabilities-srilPYuF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/createReducer-CeLhipaI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-MHIqsPCF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-8_YHxBVW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-CbvGwhr0.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-CPUmJw_F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DcDuMWp5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DJV2CjUA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-C14Sk-Bd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-vBG1bGij.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-Oad1venD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/stex-xveX5l_T.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cjs-Ck8KMDI1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseProperty-c4IQJQis.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toNumber-CTOPJrpu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/now-BXqTLlmI.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/debounce-BUM2losY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toInteger-Bor4StOs.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/type-o43RKOcp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/marked.esm-BV7g2d65.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/main-ChjX94eX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cells-A69p56PE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/kbd-DbVT085u.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/renderShortcut-DJmsjON-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useEvent-CRDKqG3C.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useDeleteCell-CEsjHDdl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/lazy-oPCv0nK8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/defaultLocale-YmL2k7Vp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/precisionRound-Qxa8hC2h.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/defaultLocale-zQltfbSS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/vega-loader.browser-D2m26-DP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/tooltip-BFMRXuzR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ErrorBoundary-_uEOjNWh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/alert-dialog-8EwWlboa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dialog-BfhgTWm1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useDebounce-DzG_89QJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/numbers-CTSqyVyD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/SSRProvider-B8x7qo1c.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/context-CcLKJeA2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useNumberFormatter-F8R3LBxf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/usePress-BO20vkQb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/input-BNb8K99m.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ImperativeModal-C4fZHLKz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cell-link-D75IV6D1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/alert-BqjCH_7t.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/links-CMl0qG9J.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/state-JZFfOGr9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/MarimoErrorOutput-BATnwNYX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/spinner-CuquyDWA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_arrayReduce-DV4IVFuG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/startCase-RfubwhHM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/strings-DHsDEFo-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/command-Dlk4i3l7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/popover-F0Sfc1dn.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useRunCells-BLpH_l8E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/copy-LsxoSTiV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/copy-Dy_tLkL8.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/copy-icon-CE7wmMnS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mode-Bq6LjPC-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/purify.es-CPMOFAIu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/RenderHTML-DTLkV9Uh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/table-DU76OrPF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/tabs-l9npw3ob.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useAsyncData-CngUoIwV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useIframeCapabilities-DXQ78nsN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/error-banner-DoSAS3iD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/formats-BN93kMCb.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useTheme-Biy2QI0v.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/en-US-D2gH55FJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/isValid-BJSfXqfd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/maps-B1z3jt-a.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/shim-Cc3VMan6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/download-ByFIcaoi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/extends-dwNt6GDg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/emotion-is-prop-valid.esm-OoyWz_0l.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useDateFormatter-CPDTrKqK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/range-ZclXTdAh.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/table-C2gUjtJV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Output-DWmT-7NV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/name-cell-input-DND1MD7b.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useHotkey-NDxGNWnW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/objectWithoutPropertiesLoose-COpOcp6W.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/esm-B3nKz9z-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-GE2AwHvG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-CMHCymvx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-ta4iJSan.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-BcppZLnk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DRTi9ht4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-BjGT2Oog.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-CXL8T4lt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-B0B_Xnwd.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-BcgNLefj.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-j2I9I0a7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DM2w8f7r.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-nhBdVy6b.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-D-JTXier.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/apl-BGS-6pM9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/asciiarmor-CbQH35y7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/asn1-P7HrFGaM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/brainfuck-CSxeyQc4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/clike-Bg9duJDo.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/clojure-B94DOmFw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cmake-DQEKyMNG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cobol-CY4gVoPW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/coffeescript-BwWb96Ts.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/commonlisp-Cq_n1sF6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/crystal-BLTq7Sqq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/css-CmDcdojQ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cypher-ByytCYVx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/d-xLFRg71F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/diff-VF6GbDch.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dtd-D8qb8bJW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dylan-CIkom9X4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ecl-8wcmTiom.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/eiffel-D2ZBcT03.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/elm-Cpg3TnMc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/erlang-B4A2pXCG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/simple-mode-BrL6eoj-.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/factor-DhbRkYZ5.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/forth-C5F1F4pC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/fortran-D7Gl3Tli.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/gas-BS2f8qHc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/gherkin-CVZcskwU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/groovy-BhQsBMwW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/haskell-BPbxlKgK.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/haxe-TKSAmiMf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/idl-DFgQu5Ek.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/javascript-dAA8UGkz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/jinja2-BIbcpWyF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/julia-CfdFJG3K.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/livescript-FcXY3DYa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/lua-Co6rjiMf.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mathematica-yb42KhnJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mbox-Kdy3h0JS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mirc-DIfBuSAc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mllike-ClozcVVR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/modelica-DfSVZeoi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mscgen-BCcB4vmY.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/mumps-Zs7zFruB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/nsis-znELVT3h.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ntriples-BZ-Gx5MV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/octave-DbhnFGQl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/oz-C8cfEyhB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/pascal-DjQLfZxE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/perl-BbHwsgL1.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/pig-siFNrhhJ.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/powershell-DtGrdgtc.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/properties-ThqBcpfC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/protobuf-RiYv9VfD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/pug-DUVdXXqU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/puppet-U5CQLRYv.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/python-Bwt6zAaD.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/q-DIhdXtBp.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/r-CWawXx6U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/rpm-CNr8ALvx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ruby-DskfS84U.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/sas-C2b2tSOH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/scheme-Cmmcrp64.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/shell-Dyv1aCg9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/sieve-B_dGzCIS.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/smalltalk-intFzbz6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/sparql-BX1c9HJU.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/stylus-X6xt1FMB.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/swift-BYNJXGdg.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/tcl-BaybuQuE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/textile-77KFAyfi.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toml-D6E8t1IG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/troff-BfktZMhT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ttcn-cfg-CstA0KVC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ttcn-DOlRqUFL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/turtle-Cx-tHjh2.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/vb-DerFRxqu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/vbscript-BPEY3B7J.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/velocity-B-lFP8Gk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/verilog-C9TzcLDl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/vhdl-v8a_uH2H.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/webidl-DmZw40AA.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/xquery-BrIWpdRx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/yacas-ofPECLUx.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/z80-DrGVKC-O.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/esm-DtCFmQ1n.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/trash-CRcefzxk.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ConsoleOutput-BJP_UIwR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/icons-DaFojEUL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/add-missing-import-Bc1Nj8aC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/blob-ISoY06EG.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/add-cell-with-ai-Bf3hYYIu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/chart-no-axes-column-DYZiSI6e.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/square-function-sjebOKTF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/spec-C5SzKl5N.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/focus-BaSDCTOl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useInstallPackage-I3kefbOO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/column-preview-WPlkULp9.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useAddCell-CREgcbTt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/toggle-DlfY8wql.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/api-YJHlT7KM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/globals-Dp5TPAWC.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/share-8z32Sr0F.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/dist-DBrqGLzW.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/memoize-DhF8x4Aa.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_toKey-16owuO_q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseSet-L2qemYhz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/utilities.esm-Bjl8-mRM.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/floating-outline-1_-JOoBX.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/eye-off-_Bp7Ir5E.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/plus-CRGccegF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/readonly-python-code-B4MS39iL.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/file-video-camera-DJUITpag.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/file-text-CFgIi1A4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/file-Cz8xVTWu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/types-Bh2kSb2q.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/label-Dcu3RhQ4.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/form-CaSJmn0I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/textarea-DeG5mMSH.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/circle-x-Dm9uA-wT.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/refresh-ccw-Dg4gNnPm.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/trash-2-BPux4_UF.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/form-DaO98mWt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/field-CaHPDBhq.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/switch-4s4187gV.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useBoolean-CpaqzlKu.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/useDeepCompareMemoize-DiJVYA6I.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/LazyAnyLanguageCodeMirror-BovGLUi6.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/types-CHAkS4Oz.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/prop-types-Dr_68tMt.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/es-vLBD1nBl.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/VisuallyHidden-DqOWapbP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_baseFlatten-ViL-mfkw.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/get-BUGWIXZE.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/hasIn-BgJKauE7.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/_basePickBy-CSDa7ReR.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/pick-BQzWKfma.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/square-CYRwTwZO.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/download-ptuQ0M1w.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/globe-mi3m-i9B.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/send-CTRovYct.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/refresh-cw-Duwwh0cP.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/settings-p8vTgdrN.js">
    <link rel="modulepreload" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/bundle.esm-BEDtDq85.js">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/cells-BvrC6Bsv.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/Output-j3zW187k.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/ConsoleOutput-BFFTcC5Y.css">
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.17.7/dist/assets/index-BmcO-QYJ.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "customer_rfm_dashboard.py",
            "mode": "read",
            "version": "0.17.7",
            "serverToken": "static",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "diagnostics": {"sql_linter": true}, "display": {"cell_output": "above", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": false}}, "mcp": {"mcpServers": {}, "presets": []}, "package_management": {"manager": "pip"}, "runtime": {"auto_instantiate": false, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"auto_download": ["html"], "sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import marimo as mo\nimport duckdb\nimport pandas as pd\nimport plotly.express as px\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\nimport os\nfrom pathlib import Path\nfrom dotenv import load_dotenv", "code_hash": "0cb79e328fbe7f8a369ecfd59b2d4056", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hbol", "name": "_"}, {"code": "mo.md(\"\"\"\n# Customer RFM Analysis Dashboard - Olist E-Commerce\n\n**Business Questions Answered:**\n- Which customers are most valuable (RFM segmentation)?\n- Who are our champions vs at-risk customers?\n- What are customer lifecycle stages?\n- Which customers should we target for reactivation?\n- How do customer segments differ in behavior?\n\n**Data Source:** mart_customer_analytics (99,441 customers)\n\n**RFM Framework:**\n- **Recency** - Days since last purchase (lower is better)\n- **Frequency** - Number of orders (higher is better)\n- **Monetary** - Total lifetime value (higher is better)\n\n**Customer Segments:**\n- Champions, Loyal Customers, Big Spenders\n- New Customers, At Risk, Lost\n- Regular customers\n\"\"\")", "code_hash": "9e5743717b43f911b0e10bb071342d16", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "MJUe", "name": "_"}, {"code": "# Load environment variables from .env file\nenv_path = Path(__file__).parent.parent.parent / '.env'\nload_dotenv(env_path)\n\n# Configure database for this notebook\ndb_name = 'olist_analytical.duckdb'\ndb_dir = os.getenv('DUCKDB_DIR')\ndb_path = os.path.join(db_dir, db_name)\n\n# Connect to DuckDB analytical database\ncon = duckdb.connect(database=db_path, read_only=True)", "code_hash": "269dfd95df1e72a8e65bf4f1101a70d4", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vblA", "name": "_"}, {"code": "mo.md(\"\"\"\n## Segment Filter\n\nSelect RFM segments to analyze:\n\"\"\")", "code_hash": "f3dff76d3e0bba32ddad406656d6ba07", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bkHC", "name": "_"}, {"code": "# Get available segments\nsegments_df = con.execute(\"\"\"\n    SELECT DISTINCT rfm_segment\n    FROM mart_customer_analytics\n    WHERE rfm_segment IS NOT NULL\n    ORDER BY rfm_segment\n\"\"\").df()\n\nsegment_list = ['All Segments'] + segments_df['rfm_segment'].tolist()", "code_hash": "622407af7e3888aca053e77f9894d276", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lEQa", "name": "_"}, {"code": "segment_filter = mo.ui.dropdown(\n    options=segment_list,\n    value='All Segments',\n    label=\"RFM Segment\"\n)\n\nlifecycle_filter = mo.ui.dropdown(\n    options=['All', 'Active Repeat', 'Active New', 'Cooling Down', 'At Risk', 'Dormant', 'Never Purchased'],\n    value='All',\n    label=\"Lifecycle Stage\"\n)\n\nmo.vstack([segment_filter, lifecycle_filter])", "code_hash": "9c092690ca36063a101a0a492c85ab2b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PKri", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## Customer Base Overview\n\nHigh-level metrics for the customer base:\n\"\"\")", "code_hash": "71196763a264600f7ff9ba13da9e894a", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Xref", "name": "_"}, {"code": "# Build filter conditions\nfilters = []\nif segment_filter.value != 'All Segments':\n    filters.append(f\"rfm_segment = '{segment_filter.value}'\")\nif lifecycle_filter.value != 'All':\n    filters.append(f\"lifecycle_stage = '{lifecycle_filter.value}'\")\n\nwhere_clause = \"WHERE \" + \" AND \".join(filters) if filters else \"\"\n\n# Calculate customer KPIs\ncustomer_kpis = con.execute(f\"\"\"\n    SELECT\n        COUNT(DISTINCT customer_id) as total_customers,\n        SUM(lifetime_value) as total_ltv,\n        AVG(lifetime_value) as avg_ltv,\n        AVG(total_orders) as avg_orders,\n        AVG(recency_days) as avg_recency,\n        AVG(avg_review_score) as avg_satisfaction\n    FROM marts_customer.mart_customer_analytics\n    {where_clause}\n\"\"\").df()\n\nkpi_data = customer_kpis.iloc[0]", "code_hash": "4d449a11f03ce8c3e4c14d5938e6519d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "SFPL", "name": "_"}, {"code": "mo.hstack([\n    mo.stat(label=\"Total Customers\", value=f\"{kpi_data['total_customers']:,}\"),\n    mo.stat(label=\"Total LTV\", value=f\"R$ {kpi_data['total_ltv']:,.2f}\"),\n    mo.stat(label=\"Avg LTV\", value=f\"R$ {kpi_data['avg_ltv']:,.2f}\"),\n    mo.stat(label=\"Avg Orders\", value=f\"{kpi_data['avg_orders']:.1f}\"),\n    mo.stat(label=\"Avg Satisfaction\", value=f\"{kpi_data['avg_satisfaction']:.2f} \u2b50\")\n])", "code_hash": "eec6dd0e1b2753c6ddd33d902fb1655e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "BYtC", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## RFM Segmentation Overview\n\nCustomer distribution across RFM segments:\n\"\"\")", "code_hash": "590aedce35a34be66a3ffd43d7332a87", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "RGSE", "name": "_"}, {"code": "rfm_segments = con.execute(\"\"\"\n    SELECT\n        rfm_segment,\n        COUNT(DISTINCT customer_id) as customer_count,\n        SUM(lifetime_value) as total_ltv,\n        AVG(lifetime_value) as avg_ltv,\n        AVG(total_orders) as avg_orders,\n        AVG(recency_days) as avg_recency,\n        AVG(rfm_total_score) as avg_rfm_score,\n        AVG(avg_review_score) as avg_satisfaction\n    FROM marts_customer.mart_customer_analytics\n    WHERE rfm_segment IS NOT NULL\n    GROUP BY rfm_segment\n    ORDER BY avg_rfm_score DESC\n\"\"\").df()\n\nrfm_segments", "code_hash": "9ff1d4224fd8f5b1a16eac9b91488cb1", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Kclp", "name": "_"}, {"code": "fig_rfm_overview = make_subplots(\n    rows=1, cols=2,\n    specs=[[{'type': 'pie'}, {'type': 'pie'}]],\n    subplot_titles=('Customer Count by Segment', 'Lifetime Value by Segment')\n)\n\ncolors = {\n    'Champions': '#27ae60',\n    'Loyal Customers': '#2ecc71',\n    'Big Spenders': '#f39c12',\n    'New Customers': '#3498db',\n    'At Risk': '#e67e22',\n    'Lost': '#e74c3c',\n    'Regular': '#95a5a6'\n}\n\nsegment_colors = [colors.get(seg, '#95a5a6') for seg in rfm_segments['rfm_segment']]\n\nfig_rfm_overview.add_trace(\n    dict(\n        type='pie',\n        labels=rfm_segments['rfm_segment'],\n        values=rfm_segments['customer_count'],\n        marker=dict(colors=segment_colors),\n        name='Customers'\n    ),\n    row=1, col=1\n)\n\nfig_rfm_overview.add_trace(\n    dict(\n        type='pie',\n        labels=rfm_segments['rfm_segment'],\n        values=rfm_segments['total_ltv'],\n        marker=dict(colors=segment_colors),\n        name='LTV'\n    ),\n    row=1, col=2\n)\n\nfig_rfm_overview.update_layout(\n    title=\"RFM Segment Distribution\",\n    height=500\n)\n\nfig_rfm_overview", "code_hash": "8861814242f994920fed03e657ad6669", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "emfo", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## RFM Score Distribution\n\nIndividual R, F, M scores across the customer base:\n\"\"\")", "code_hash": "942dc8f4ca02d7f163fdce4b759fb73c", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hstk", "name": "_"}, {"code": "rfm_score_dist = con.execute(f\"\"\"\n    SELECT\n        recency_score,\n        frequency_score,\n        monetary_score,\n        COUNT(DISTINCT customer_id) as customer_count\n    FROM marts_customer.mart_customer_analytics\n    {where_clause}\n    GROUP BY recency_score, frequency_score, monetary_score\n    ORDER BY recency_score, frequency_score, monetary_score\n\"\"\").df()", "code_hash": "23756b387180231aa8999833c43318e4", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nWHF", "name": "_"}, {"code": "# Get score averages by segment\nscore_by_segment = con.execute(f\"\"\"\n    SELECT\n        rfm_segment,\n        AVG(recency_score) as avg_r,\n        AVG(frequency_score) as avg_f,\n        AVG(monetary_score) as avg_m\n    FROM marts_customer.mart_customer_analytics\n    {where_clause}\n    AND rfm_segment IS NOT NULL\n    GROUP BY rfm_segment\n    ORDER BY (avg_r + avg_f + avg_m) DESC\n\"\"\").df()", "code_hash": "f93016b49ee4262e0d121d256dd761c0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "iLit", "name": "_"}, {"code": "fig_rfm_scores = go.Figure()\n\nfig_rfm_scores.add_trace(go.Bar(\n    name='Recency Score',\n    x=score_by_segment['rfm_segment'],\n    y=score_by_segment['avg_r'],\n    marker_color='#3498db'\n))\n\nfig_rfm_scores.add_trace(go.Bar(\n    name='Frequency Score',\n    x=score_by_segment['rfm_segment'],\n    y=score_by_segment['avg_f'],\n    marker_color='#2ecc71'\n))\n\nfig_rfm_scores.add_trace(go.Bar(\n    name='Monetary Score',\n    x=score_by_segment['rfm_segment'],\n    y=score_by_segment['avg_m'],\n    marker_color='#f39c12'\n))\n\nfig_rfm_scores.update_layout(\n    title='Average RFM Scores by Segment',\n    xaxis_title='RFM Segment',\n    yaxis_title='Score (1-5)',\n    barmode='group',\n    height=500\n)\n\nfig_rfm_scores", "code_hash": "ffe153ea6b55111f28d5cd3674ef9f83", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZHCJ", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## Customer Lifecycle Analysis\n\nDistribution across lifecycle stages:\n\"\"\")", "code_hash": "b5905573ced0bf7186dce7ffdd234f87", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ROlb", "name": "_"}, {"code": "lifecycle_data = con.execute(\"\"\"\n    SELECT\n        lifecycle_stage,\n        COUNT(DISTINCT customer_id) as customer_count,\n        SUM(lifetime_value) as total_ltv,\n        AVG(lifetime_value) as avg_ltv,\n        AVG(recency_days) as avg_recency,\n        AVG(total_orders) as avg_orders,\n        AVG(avg_review_score) as avg_satisfaction\n    FROM marts_customer.mart_customer_analytics\n    GROUP BY lifecycle_stage\n    ORDER BY\n        CASE lifecycle_stage\n            WHEN 'Active Repeat' THEN 1\n            WHEN 'Active New' THEN 2\n            WHEN 'Cooling Down' THEN 3\n            WHEN 'At Risk' THEN 4\n            WHEN 'Dormant' THEN 5\n            WHEN 'Never Purchased' THEN 6\n        END\n\"\"\").df()\n\nlifecycle_data", "code_hash": "5a24938642aa176640509f9446b6d4fe", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "qnkX", "name": "_"}, {"code": "fig_lifecycle = make_subplots(\n    rows=2, cols=2,\n    subplot_titles=(\n        'Customer Count', 'Total Lifetime Value',\n        'Avg Orders per Customer', 'Avg Recency (days)'\n    ),\n    specs=[[{'type': 'bar'}, {'type': 'bar'}],\n           [{'type': 'bar'}, {'type': 'bar'}]]\n)\n\nlifecycle_colors = {\n    'Active Repeat': '#27ae60',\n    'Active New': '#2ecc71',\n    'Cooling Down': '#f39c12',\n    'At Risk': '#e67e22',\n    'Dormant': '#e74c3c',\n    'Never Purchased': '#95a5a6'\n}\n\nbar_colors = [lifecycle_colors.get(stage, '#95a5a6') for stage in lifecycle_data['lifecycle_stage']]\n\nfig_lifecycle.add_trace(\n    dict(\n        type='bar',\n        x=lifecycle_data['lifecycle_stage'],\n        y=lifecycle_data['customer_count'],\n        marker=dict(color=bar_colors)\n    ),\n    row=1, col=1\n)\n\nfig_lifecycle.add_trace(\n    dict(\n        type='bar',\n        x=lifecycle_data['lifecycle_stage'],\n        y=lifecycle_data['total_ltv'],\n        marker=dict(color=bar_colors)\n    ),\n    row=1, col=2\n)\n\nfig_lifecycle.add_trace(\n    dict(\n        type='bar',\n        x=lifecycle_data['lifecycle_stage'],\n        y=lifecycle_data['avg_orders'],\n        marker=dict(color=bar_colors)\n    ),\n    row=2, col=1\n)\n\nfig_lifecycle.add_trace(\n    dict(\n        type='bar',\n        x=lifecycle_data['lifecycle_stage'],\n        y=lifecycle_data['avg_recency'],\n        marker=dict(color=bar_colors)\n    ),\n    row=2, col=2\n)\n\nfig_lifecycle.update_layout(\n    title=\"Customer Lifecycle Analysis\",\n    height=700,\n    showlegend=False\n)\n\nfig_lifecycle", "code_hash": "4e182f5eca415937c53d66e55d6dd142", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TqIu", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## Value Tier Analysis\n\nCustomer segmentation by lifetime value:\n\"\"\")", "code_hash": "a3325f5a62ca52b0151839fc6cf5e1f6", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Vxnm", "name": "_"}, {"code": "value_tiers = con.execute(\"\"\"\n    SELECT\n        value_tier,\n        COUNT(DISTINCT customer_id) as customer_count,\n        SUM(lifetime_value) as total_ltv,\n        AVG(lifetime_value) as avg_ltv,\n        AVG(total_orders) as avg_orders,\n        MIN(lifetime_value) as min_ltv,\n        MAX(lifetime_value) as max_ltv\n    FROM marts_customer.mart_customer_analytics\n    GROUP BY value_tier\n    ORDER BY\n        CASE value_tier\n            WHEN 'VIP' THEN 1\n            WHEN 'High Value' THEN 2\n            WHEN 'Medium Value' THEN 3\n            WHEN 'Low Value' THEN 4\n            WHEN 'No Orders' THEN 5\n        END\n\"\"\").df()\n\nvalue_tiers", "code_hash": "34466b6b0971c985b4addc119901f726", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "DnEU", "name": "_"}, {"code": "# Value tier contribution\nfig_value_tiers = px.sunburst(\n    value_tiers,\n    path=['value_tier'],\n    values='total_ltv',\n    color='avg_ltv',\n    color_continuous_scale='Greens',\n    title='Revenue Contribution by Value Tier'\n)\n\nfig_value_tiers.update_layout(height=600)\nfig_value_tiers", "code_hash": "2f7bc69a0223d16a4ee30a485484c18b", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ulZA", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## RFM Segment Deep Dive\n\nDetailed characteristics of each segment:\n\"\"\")", "code_hash": "8767f83583436c055078721cd6ed74a8", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ecfG", "name": "_"}, {"code": "segment_characteristics = con.execute(f\"\"\"\n    SELECT\n        rfm_segment,\n        COUNT(DISTINCT customer_id) as customers,\n        AVG(recency_days) as avg_recency_days,\n        AVG(frequency) as avg_frequency,\n        AVG(monetary_value) as avg_monetary,\n        AVG(lifetime_value) as avg_ltv,\n        AVG(total_orders) as avg_orders,\n        AVG(avg_order_value) as avg_order_value,\n        AVG(avg_review_score) as avg_satisfaction,\n        AVG(on_time_delivery_rate) as avg_on_time_rate,\n        SUM(lifetime_value) / SUM(SUM(lifetime_value)) OVER () * 100 as ltv_contribution_pct\n    FROM marts_customer.mart_customer_analytics\n    {where_clause}\n    AND rfm_segment IS NOT NULL\n    GROUP BY rfm_segment\n    ORDER BY ltv_contribution_pct DESC\n\"\"\").df()\n\nsegment_characteristics", "code_hash": "41f928bd229ae2bdee8ba58f4624c4a4", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Pvdt", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## Reactivation Opportunities\n\nCustomers at risk or dormant that could be targeted:\n\"\"\")", "code_hash": "90c3374700a987e1da0129c291a03766", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "ZBYS", "name": "_"}, {"code": "reactivation_targets = con.execute(\"\"\"\n    SELECT\n        rfm_segment,\n        lifecycle_stage,\n        COUNT(DISTINCT customer_id) as customer_count,\n        SUM(lifetime_value) as historical_ltv,\n        AVG(total_orders) as avg_past_orders,\n        AVG(recency_days) as avg_days_since_purchase,\n        AVG(avg_review_score) as avg_past_satisfaction\n    FROM marts_customer.mart_customer_analytics\n    WHERE rfm_segment IN ('At Risk', 'Lost')\n       OR lifecycle_stage IN ('Cooling Down', 'At Risk', 'Dormant')\n    GROUP BY rfm_segment, lifecycle_stage\n    ORDER BY historical_ltv DESC\n\"\"\").df()\n\nreactivation_targets", "code_hash": "a31566acf1873b8671d6f745cab3b1e9", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aLJB", "name": "_"}, {"code": "fig_reactivation = go.Figure()\n\nfig_reactivation.add_trace(go.Bar(\n    x=reactivation_targets['rfm_segment'] + ' - ' + reactivation_targets['lifecycle_stage'],\n    y=reactivation_targets['customer_count'],\n    marker=dict(\n        color=reactivation_targets['historical_ltv'],\n        colorscale='Reds',\n        showscale=True,\n        colorbar=dict(title=\"Historical\u003Cbr\u003ELTV\")\n    ),\n    text=reactivation_targets['customer_count'],\n    textposition='outside',\n    hovertemplate='\u003Cb\u003E%{x}\u003C/b\u003E\u003Cbr\u003ECustomers: %{y}\u003Cbr\u003EHistorical LTV: R$ %{marker.color:,.2f}\u003Cextra\u003E\u003C/extra\u003E'\n))\n\nfig_reactivation.update_layout(\n    title=\"Reactivation Opportunities (At Risk \u0026 Lost Customers)\",\n    xaxis_title=\"Segment - Lifecycle Stage\",\n    yaxis_title=\"Customer Count\",\n    height=600,\n    showlegend=False\n)\n\nfig_reactivation.update_xaxes(tickangle=45)\nfig_reactivation", "code_hash": "56274d366575591ee85ada894a719c21", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "nHfw", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## Geographic Distribution by Segment\n\nRegional presence of different customer segments:\n\"\"\")", "code_hash": "cf0a84ccaf0ccac78f03bc951e4289c8", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "xXTn", "name": "_"}, {"code": "segment_by_region = con.execute(\"\"\"\n    SELECT\n        region,\n        rfm_segment,\n        COUNT(DISTINCT customer_id) as customer_count,\n        SUM(lifetime_value) as total_ltv\n    FROM marts_customer.mart_customer_analytics\n    WHERE region IS NOT NULL\n    AND rfm_segment IS NOT NULL\n    GROUP BY region, rfm_segment\n    ORDER BY region, total_ltv DESC\n\"\"\").df()", "code_hash": "c5f8ebeaf0e86120a3f6b83d7d538f61", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "AjVT", "name": "_"}, {"code": "fig_region_segment = px.bar(\n    segment_by_region,\n    x='region',\n    y='customer_count',\n    color='rfm_segment',\n    title='Customer Segments by Region',\n    labels={\n        'region': 'Region',\n        'customer_count': 'Customer Count',\n        'rfm_segment': 'RFM Segment'\n    },\n    height=600,\n    barmode='stack'\n)\n\nfig_region_segment", "code_hash": "4ea1d832809512cfa69c00553498a571", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "pHFh", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## Customer Behavior Patterns\n\nPurchase and review behavior by segment:\n\"\"\")", "code_hash": "6c126a7a2eae1937ce8c233de1e382e3", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "NCOB", "name": "_"}, {"code": "behavior_patterns = con.execute(f\"\"\"\n    SELECT\n        rfm_segment,\n        AVG(avg_days_between_orders) as avg_repurchase_cycle,\n        AVG(avg_items_per_order) as avg_basket_size,\n        AVG(installment_orders) / NULLIF(AVG(total_orders), 0) * 100 as installment_rate,\n        AVG(orders_with_comments) / NULLIF(AVG(total_orders), 0) * 100 as comment_rate,\n        AVG(unique_categories_purchased) as avg_categories\n    FROM marts_customer.mart_customer_analytics\n    {where_clause}\n    AND rfm_segment IS NOT NULL\n    GROUP BY rfm_segment\n    ORDER BY avg_repurchase_cycle\n\"\"\").df()", "code_hash": "ceef36615c53073ff3394027d53158e0", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "aqbW", "name": "_"}, {"code": "fig_behavior = make_subplots(\n    rows=2, cols=2,\n    subplot_titles=(\n        'Avg Repurchase Cycle (days)', 'Avg Basket Size (items)',\n        'Installment Usage Rate (%)', 'Avg Categories Purchased'\n    ),\n    specs=[[{'type': 'bar'}, {'type': 'bar'}],\n           [{'type': 'bar'}, {'type': 'bar'}]]\n)\n\nfig_behavior.add_trace(\n    dict(\n        type='bar',\n        x=behavior_patterns['rfm_segment'],\n        y=behavior_patterns['avg_repurchase_cycle'],\n        marker=dict(color='#3498db')\n    ),\n    row=1, col=1\n)\n\nfig_behavior.add_trace(\n    dict(\n        type='bar',\n        x=behavior_patterns['rfm_segment'],\n        y=behavior_patterns['avg_basket_size'],\n        marker=dict(color='#2ecc71')\n    ),\n    row=1, col=2\n)\n\nfig_behavior.add_trace(\n    dict(\n        type='bar',\n        x=behavior_patterns['rfm_segment'],\n        y=behavior_patterns['installment_rate'],\n        marker=dict(color='#f39c12')\n    ),\n    row=2, col=1\n)\n\nfig_behavior.add_trace(\n    dict(\n        type='bar',\n        x=behavior_patterns['rfm_segment'],\n        y=behavior_patterns['avg_categories'],\n        marker=dict(color='#9b59b6')\n    ),\n    row=2, col=2\n)\n\nfig_behavior.update_layout(\n    title=\"Customer Behavior Patterns by RFM Segment\",\n    height=700,\n    showlegend=False\n)\n\nfig_behavior.update_xaxes(tickangle=45)\nfig_behavior", "code_hash": "38dce4170f17eff882de992378bdc16e", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TRpd", "name": "_"}, {"code": "mo.md(\"\"\"\n---\n## Key Insights \u0026 Recommendations\n\n**Segment Strategies:**\n\n**Champions** (High R, F, M)\n- Reward with exclusive perks and early access\n- Use as brand ambassadors\n- Maintain high service quality\n\n**Loyal Customers** (Good R, F, M)\n- Upsell and cross-sell opportunities\n- Encourage referrals\n- Build long-term relationships\n\n**Big Spenders** (High M, varying R, F)\n- VIP treatment and personalized service\n- Premium product recommendations\n- Special pricing or bundles\n\n**New Customers** (High R, low F)\n- Welcome programs and onboarding\n- Product education\n- Incentivize second purchase\n\n**At Risk** (Low R, high F)\n- Win-back campaigns with special offers\n- Survey for feedback\n- Remind of past positive experiences\n\n**Lost** (Very low R)\n- Aggressive reactivation campaigns\n- Significant discounts or promotions\n- Understand reasons for churn\n\n**Regular** (Average scores)\n- Nurture with consistent engagement\n- Move up to Loyal or Champions\n- Prevent downgrade to At Risk\n\"\"\")", "code_hash": "fef2698588b2558294ccb619c6236007", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "TXez", "name": "_"}], "metadata": {"marimo_version": "0.17.7"}, "version": "1"},
            "session": {"cells": [{"code_hash": "0cb79e328fbe7f8a369ecfd59b2d4056", "console": [], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "9e5743717b43f911b0e10bb071342d16", "console": [], "id": "MJUe", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch1 id=\"customer-rfm-analysis-dashboard-olist-e-commerce\"\u003ECustomer RFM Analysis Dashboard - Olist E-Commerce\u003C/h1\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EBusiness Questions Answered:\u003C/strong\u003E\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EWhich customers are most valuable (RFM segmentation)?\u003C/li\u003E\n\u003Cli\u003EWho are our champions vs at-risk customers?\u003C/li\u003E\n\u003Cli\u003EWhat are customer lifecycle stages?\u003C/li\u003E\n\u003Cli\u003EWhich customers should we target for reactivation?\u003C/li\u003E\n\u003Cli\u003EHow do customer segments differ in behavior?\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EData Source:\u003C/strong\u003E mart_customer_analytics (99,441 customers)\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ERFM Framework:\u003C/strong\u003E\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Cstrong\u003ERecency\u003C/strong\u003E - Days since last purchase (lower is better)\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EFrequency\u003C/strong\u003E - Number of orders (higher is better)\u003C/li\u003E\n\u003Cli\u003E\u003Cstrong\u003EMonetary\u003C/strong\u003E - Total lifetime value (higher is better)\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ECustomer Segments:\u003C/strong\u003E\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EChampions, Loyal Customers, Big Spenders\u003C/li\u003E\n\u003Cli\u003ENew Customers, At Risk, Lost\u003C/li\u003E\n\u003Cli\u003ERegular customers\u003C/li\u003E\n\u003C/ul\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "269dfd95df1e72a8e65bf4f1101a70d4", "console": [], "id": "vblA", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "f3dff76d3e0bba32ddad406656d6ba07", "console": [], "id": "bkHC", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Ch2 id=\"segment-filter\"\u003ESegment Filter\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ESelect RFM segments to analyze:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "622407af7e3888aca053e77f9894d276", "console": [], "id": "lEQa", "outputs": [{"ename": "sql-error", "evalue": "Catalog Error: Table with name mart_customer_analytics does not exist!\nDid you mean \"core_mart.mart_customer_analytics\"?\n\nLINE 3:     FROM mart_customer_analytics\n                 ^", "traceback": [], "type": "error"}]}, {"code_hash": "9c092690ca36063a101a0a492c85ab2b", "console": [], "id": "PKri", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "71196763a264600f7ff9ba13da9e894a", "console": [], "id": "Xref", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"customer-base-overview\"\u003ECustomer Base Overview\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EHigh-level metrics for the customer base:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "4d449a11f03ce8c3e4c14d5938e6519d", "console": [], "id": "SFPL", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "eec6dd0e1b2753c6ddd33d902fb1655e", "console": [], "id": "BYtC", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "590aedce35a34be66a3ffd43d7332a87", "console": [], "id": "RGSE", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"rfm-segmentation-overview\"\u003ERFM Segmentation Overview\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ECustomer distribution across RFM segments:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "9ff1d4224fd8f5b1a16eac9b91488cb1", "console": [], "id": "Kclp", "outputs": [{"ename": "sql-error", "evalue": "Catalog Error: Table with name mart_customer_analytics does not exist!\nDid you mean \"core_mart.mart_customer_analytics\"?\n\nLINE 11:     FROM marts_customer.mart_customer_analytics\n                  ^", "traceback": [], "type": "error"}]}, {"code_hash": "8861814242f994920fed03e657ad6669", "console": [], "id": "emfo", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "942dc8f4ca02d7f163fdce4b759fb73c", "console": [], "id": "Hstk", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"rfm-score-distribution\"\u003ERFM Score Distribution\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EIndividual R, F, M scores across the customer base:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "23756b387180231aa8999833c43318e4", "console": [], "id": "nWHF", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "f93016b49ee4262e0d121d256dd761c0", "console": [], "id": "iLit", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "ffe153ea6b55111f28d5cd3674ef9f83", "console": [], "id": "ZHCJ", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "b5905573ced0bf7186dce7ffdd234f87", "console": [], "id": "ROlb", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"customer-lifecycle-analysis\"\u003ECustomer Lifecycle Analysis\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EDistribution across lifecycle stages:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "5a24938642aa176640509f9446b6d4fe", "console": [], "id": "qnkX", "outputs": [{"ename": "sql-error", "evalue": "Catalog Error: Table with name mart_customer_analytics does not exist!\nDid you mean \"core_mart.mart_customer_analytics\"?\n\nLINE 10:     FROM marts_customer.mart_customer_analytics\n                  ^", "traceback": [], "type": "error"}]}, {"code_hash": "4e182f5eca415937c53d66e55d6dd142", "console": [], "id": "TqIu", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "a3325f5a62ca52b0151839fc6cf5e1f6", "console": [], "id": "Vxnm", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"value-tier-analysis\"\u003EValue Tier Analysis\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ECustomer segmentation by lifetime value:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "34466b6b0971c985b4addc119901f726", "console": [], "id": "DnEU", "outputs": [{"ename": "sql-error", "evalue": "Catalog Error: Table with name mart_customer_analytics does not exist!\nDid you mean \"core_mart.mart_customer_analytics\"?\n\nLINE 10:     FROM marts_customer.mart_customer_analytics\n                  ^", "traceback": [], "type": "error"}]}, {"code_hash": "2f7bc69a0223d16a4ee30a485484c18b", "console": [], "id": "ulZA", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "8767f83583436c055078721cd6ed74a8", "console": [], "id": "ecfG", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"rfm-segment-deep-dive\"\u003ERFM Segment Deep Dive\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EDetailed characteristics of each segment:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "41f928bd229ae2bdee8ba58f4624c4a4", "console": [], "id": "Pvdt", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "90c3374700a987e1da0129c291a03766", "console": [], "id": "ZBYS", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"reactivation-opportunities\"\u003EReactivation Opportunities\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ECustomers at risk or dormant that could be targeted:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "a31566acf1873b8671d6f745cab3b1e9", "console": [], "id": "aLJB", "outputs": [{"ename": "sql-error", "evalue": "Catalog Error: Table with name mart_customer_analytics does not exist!\nDid you mean \"core_mart.mart_customer_analytics\"?\n\nLINE 10:     FROM marts_customer.mart_customer_analytics\n                  ^", "traceback": [], "type": "error"}]}, {"code_hash": "56274d366575591ee85ada894a719c21", "console": [], "id": "nHfw", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "cf0a84ccaf0ccac78f03bc951e4289c8", "console": [], "id": "xXTn", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"geographic-distribution-by-segment\"\u003EGeographic Distribution by Segment\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003ERegional presence of different customer segments:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "c5f8ebeaf0e86120a3f6b83d7d538f61", "console": [], "id": "AjVT", "outputs": [{"ename": "sql-error", "evalue": "Catalog Error: Table with name mart_customer_analytics does not exist!\nDid you mean \"core_mart.mart_customer_analytics\"?\n\nLINE 7:     FROM marts_customer.mart_customer_analytics\n                 ^", "traceback": [], "type": "error"}]}, {"code_hash": "4ea1d832809512cfa69c00553498a571", "console": [], "id": "pHFh", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "6c126a7a2eae1937ce8c233de1e382e3", "console": [], "id": "NCOB", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"customer-behavior-patterns\"\u003ECustomer Behavior Patterns\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003EPurchase and review behavior by segment:\u003C/span\u003E\u003C/span\u003E"}, "type": "data"}]}, {"code_hash": "ceef36615c53073ff3394027d53158e0", "console": [], "id": "aqbW", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "38dce4170f17eff882de992378bdc16e", "console": [], "id": "TRpd", "outputs": [{"ename": "exception", "evalue": "An ancestor raised an exception (MarimoSQLError): ", "traceback": [], "type": "error"}]}, {"code_hash": "fef2698588b2558294ccb619c6236007", "console": [], "id": "TXez", "outputs": [{"data": {"text/markdown": "\u003Cspan class=\"markdown prose dark:prose-invert contents\"\u003E\u003Chr /\u003E\n\u003Ch2 id=\"key-insights-recommendations\"\u003EKey Insights \u0026amp; Recommendations\u003C/h2\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ESegment Strategies:\u003C/strong\u003E\u003C/span\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EChampions\u003C/strong\u003E (High R, F, M)\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EReward with exclusive perks and early access\u003C/li\u003E\n\u003Cli\u003EUse as brand ambassadors\u003C/li\u003E\n\u003Cli\u003EMaintain high service quality\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ELoyal Customers\u003C/strong\u003E (Good R, F, M)\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EUpsell and cross-sell opportunities\u003C/li\u003E\n\u003Cli\u003EEncourage referrals\u003C/li\u003E\n\u003Cli\u003EBuild long-term relationships\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EBig Spenders\u003C/strong\u003E (High M, varying R, F)\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EVIP treatment and personalized service\u003C/li\u003E\n\u003Cli\u003EPremium product recommendations\u003C/li\u003E\n\u003Cli\u003ESpecial pricing or bundles\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ENew Customers\u003C/strong\u003E (High R, low F)\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EWelcome programs and onboarding\u003C/li\u003E\n\u003Cli\u003EProduct education\u003C/li\u003E\n\u003Cli\u003EIncentivize second purchase\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003EAt Risk\u003C/strong\u003E (Low R, high F)\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EWin-back campaigns with special offers\u003C/li\u003E\n\u003Cli\u003ESurvey for feedback\u003C/li\u003E\n\u003Cli\u003ERemind of past positive experiences\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ELost\u003C/strong\u003E (Very low R)\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003EAggressive reactivation campaigns\u003C/li\u003E\n\u003Cli\u003ESignificant discounts or promotions\u003C/li\u003E\n\u003Cli\u003EUnderstand reasons for churn\u003C/li\u003E\n\u003C/ul\u003E\n\u003Cspan class=\"paragraph\"\u003E\u003Cstrong\u003ERegular\u003C/strong\u003E (Average scores)\u003C/span\u003E\n\u003Cul\u003E\n\u003Cli\u003ENurture with consistent engagement\u003C/li\u003E\n\u003Cli\u003EMove up to Loyal or Champions\u003C/li\u003E\n\u003Cli\u003EPrevent downgrade to At Risk\u003C/li\u003E\n\u003C/ul\u003E\u003C/span\u003E"}, "type": "data"}]}], "metadata": {"marimo_version": "0.17.7"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.17.7%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22%2C%20auto_download%3D%5B%22html%22%5D)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20import%20duckdb%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20plotly.express%20as%20px%0A%20%20%20%20import%20plotly.graph_objects%20as%20go%0A%20%20%20%20from%20plotly.subplots%20import%20make_subplots%0A%20%20%20%20import%20os%0A%20%20%20%20from%20pathlib%20import%20Path%0A%20%20%20%20from%20dotenv%20import%20load_dotenv%0A%20%20%20%20return%20Path%2C%20duckdb%2C%20go%2C%20load_dotenv%2C%20make_subplots%2C%20mo%2C%20os%2C%20px%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%20Customer%20RFM%20Analysis%20Dashboard%20-%20Olist%20E-Commerce%0A%0A%20%20%20%20**Business%20Questions%20Answered%3A**%0A%20%20%20%20-%20Which%20customers%20are%20most%20valuable%20(RFM%20segmentation)%3F%0A%20%20%20%20-%20Who%20are%20our%20champions%20vs%20at-risk%20customers%3F%0A%20%20%20%20-%20What%20are%20customer%20lifecycle%20stages%3F%0A%20%20%20%20-%20Which%20customers%20should%20we%20target%20for%20reactivation%3F%0A%20%20%20%20-%20How%20do%20customer%20segments%20differ%20in%20behavior%3F%0A%0A%20%20%20%20**Data%20Source%3A**%20mart_customer_analytics%20(99%2C441%20customers)%0A%0A%20%20%20%20**RFM%20Framework%3A**%0A%20%20%20%20-%20**Recency**%20-%20Days%20since%20last%20purchase%20(lower%20is%20better)%0A%20%20%20%20-%20**Frequency**%20-%20Number%20of%20orders%20(higher%20is%20better)%0A%20%20%20%20-%20**Monetary**%20-%20Total%20lifetime%20value%20(higher%20is%20better)%0A%0A%20%20%20%20**Customer%20Segments%3A**%0A%20%20%20%20-%20Champions%2C%20Loyal%20Customers%2C%20Big%20Spenders%0A%20%20%20%20-%20New%20Customers%2C%20At%20Risk%2C%20Lost%0A%20%20%20%20-%20Regular%20customers%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(Path%2C%20duckdb%2C%20load_dotenv%2C%20os)%3A%0A%20%20%20%20%23%20Load%20environment%20variables%20from%20.env%20file%0A%20%20%20%20env_path%20%3D%20Path(__file__).parent.parent.parent%20%2F%20'.env'%0A%20%20%20%20load_dotenv(env_path)%0A%0A%20%20%20%20%23%20Configure%20database%20for%20this%20notebook%0A%20%20%20%20db_name%20%3D%20'olist_analytical.duckdb'%0A%20%20%20%20db_dir%20%3D%20os.getenv('DUCKDB_DIR')%0A%20%20%20%20db_path%20%3D%20os.path.join(db_dir%2C%20db_name)%0A%0A%20%20%20%20%23%20Connect%20to%20DuckDB%20analytical%20database%0A%20%20%20%20con%20%3D%20duckdb.connect(database%3Ddb_path%2C%20read_only%3DTrue)%0A%20%20%20%20return%20(con%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%23%23%20Segment%20Filter%0A%0A%20%20%20%20Select%20RFM%20segments%20to%20analyze%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con)%3A%0A%20%20%20%20%23%20Get%20available%20segments%0A%20%20%20%20segments_df%20%3D%20con.execute(%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%20DISTINCT%20rfm_segment%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20WHERE%20rfm_segment%20IS%20NOT%20NULL%0A%20%20%20%20%20%20%20%20ORDER%20BY%20rfm_segment%0A%20%20%20%20%22%22%22).df()%0A%0A%20%20%20%20segment_list%20%3D%20%5B'All%20Segments'%5D%20%2B%20segments_df%5B'rfm_segment'%5D.tolist()%0A%20%20%20%20return%20(segment_list%2C)%0A%0A%0A%40app.cell%0Adef%20_(mo%2C%20segment_list)%3A%0A%20%20%20%20segment_filter%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20options%3Dsegment_list%2C%0A%20%20%20%20%20%20%20%20value%3D'All%20Segments'%2C%0A%20%20%20%20%20%20%20%20label%3D%22RFM%20Segment%22%0A%20%20%20%20)%0A%0A%20%20%20%20lifecycle_filter%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20options%3D%5B'All'%2C%20'Active%20Repeat'%2C%20'Active%20New'%2C%20'Cooling%20Down'%2C%20'At%20Risk'%2C%20'Dormant'%2C%20'Never%20Purchased'%5D%2C%0A%20%20%20%20%20%20%20%20value%3D'All'%2C%0A%20%20%20%20%20%20%20%20label%3D%22Lifecycle%20Stage%22%0A%20%20%20%20)%0A%0A%20%20%20%20mo.vstack(%5Bsegment_filter%2C%20lifecycle_filter%5D)%0A%20%20%20%20return%20lifecycle_filter%2C%20segment_filter%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20Customer%20Base%20Overview%0A%0A%20%20%20%20High-level%20metrics%20for%20the%20customer%20base%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con%2C%20lifecycle_filter%2C%20segment_filter)%3A%0A%20%20%20%20%23%20Build%20filter%20conditions%0A%20%20%20%20filters%20%3D%20%5B%5D%0A%20%20%20%20if%20segment_filter.value%20!%3D%20'All%20Segments'%3A%0A%20%20%20%20%20%20%20%20filters.append(f%22rfm_segment%20%3D%20'%7Bsegment_filter.value%7D'%22)%0A%20%20%20%20if%20lifecycle_filter.value%20!%3D%20'All'%3A%0A%20%20%20%20%20%20%20%20filters.append(f%22lifecycle_stage%20%3D%20'%7Blifecycle_filter.value%7D'%22)%0A%0A%20%20%20%20where_clause%20%3D%20%22WHERE%20%22%20%2B%20%22%20AND%20%22.join(filters)%20if%20filters%20else%20%22%22%0A%0A%20%20%20%20%23%20Calculate%20customer%20KPIs%0A%20%20%20%20customer_kpis%20%3D%20con.execute(f%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20COUNT(DISTINCT%20customer_id)%20as%20total_customers%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20SUM(lifetime_value)%20as%20total_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(lifetime_value)%20as%20avg_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(total_orders)%20as%20avg_orders%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(recency_days)%20as%20avg_recency%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(avg_review_score)%20as%20avg_satisfaction%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20%7Bwhere_clause%7D%0A%20%20%20%20%22%22%22).df()%0A%0A%20%20%20%20kpi_data%20%3D%20customer_kpis.iloc%5B0%5D%0A%20%20%20%20return%20kpi_data%2C%20where_clause%0A%0A%0A%40app.cell%0Adef%20_(kpi_data%2C%20mo)%3A%0A%20%20%20%20mo.hstack(%5B%0A%20%20%20%20%20%20%20%20mo.stat(label%3D%22Total%20Customers%22%2C%20value%3Df%22%7Bkpi_data%5B'total_customers'%5D%3A%2C%7D%22)%2C%0A%20%20%20%20%20%20%20%20mo.stat(label%3D%22Total%20LTV%22%2C%20value%3Df%22R%24%20%7Bkpi_data%5B'total_ltv'%5D%3A%2C.2f%7D%22)%2C%0A%20%20%20%20%20%20%20%20mo.stat(label%3D%22Avg%20LTV%22%2C%20value%3Df%22R%24%20%7Bkpi_data%5B'avg_ltv'%5D%3A%2C.2f%7D%22)%2C%0A%20%20%20%20%20%20%20%20mo.stat(label%3D%22Avg%20Orders%22%2C%20value%3Df%22%7Bkpi_data%5B'avg_orders'%5D%3A.1f%7D%22)%2C%0A%20%20%20%20%20%20%20%20mo.stat(label%3D%22Avg%20Satisfaction%22%2C%20value%3Df%22%7Bkpi_data%5B'avg_satisfaction'%5D%3A.2f%7D%20%E2%AD%90%22)%0A%20%20%20%20%5D)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20RFM%20Segmentation%20Overview%0A%0A%20%20%20%20Customer%20distribution%20across%20RFM%20segments%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con)%3A%0A%20%20%20%20rfm_segments%20%3D%20con.execute(%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20rfm_segment%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20COUNT(DISTINCT%20customer_id)%20as%20customer_count%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20SUM(lifetime_value)%20as%20total_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(lifetime_value)%20as%20avg_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(total_orders)%20as%20avg_orders%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(recency_days)%20as%20avg_recency%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(rfm_total_score)%20as%20avg_rfm_score%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(avg_review_score)%20as%20avg_satisfaction%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20WHERE%20rfm_segment%20IS%20NOT%20NULL%0A%20%20%20%20%20%20%20%20GROUP%20BY%20rfm_segment%0A%20%20%20%20%20%20%20%20ORDER%20BY%20avg_rfm_score%20DESC%0A%20%20%20%20%22%22%22).df()%0A%0A%20%20%20%20rfm_segments%0A%20%20%20%20return%20(rfm_segments%2C)%0A%0A%0A%40app.cell%0Adef%20_(make_subplots%2C%20rfm_segments)%3A%0A%20%20%20%20fig_rfm_overview%20%3D%20make_subplots(%0A%20%20%20%20%20%20%20%20rows%3D1%2C%20cols%3D2%2C%0A%20%20%20%20%20%20%20%20specs%3D%5B%5B%7B'type'%3A%20'pie'%7D%2C%20%7B'type'%3A%20'pie'%7D%5D%5D%2C%0A%20%20%20%20%20%20%20%20subplot_titles%3D('Customer%20Count%20by%20Segment'%2C%20'Lifetime%20Value%20by%20Segment')%0A%20%20%20%20)%0A%0A%20%20%20%20colors%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'Champions'%3A%20'%2327ae60'%2C%0A%20%20%20%20%20%20%20%20'Loyal%20Customers'%3A%20'%232ecc71'%2C%0A%20%20%20%20%20%20%20%20'Big%20Spenders'%3A%20'%23f39c12'%2C%0A%20%20%20%20%20%20%20%20'New%20Customers'%3A%20'%233498db'%2C%0A%20%20%20%20%20%20%20%20'At%20Risk'%3A%20'%23e67e22'%2C%0A%20%20%20%20%20%20%20%20'Lost'%3A%20'%23e74c3c'%2C%0A%20%20%20%20%20%20%20%20'Regular'%3A%20'%2395a5a6'%0A%20%20%20%20%7D%0A%0A%20%20%20%20segment_colors%20%3D%20%5Bcolors.get(seg%2C%20'%2395a5a6')%20for%20seg%20in%20rfm_segments%5B'rfm_segment'%5D%5D%0A%0A%20%20%20%20fig_rfm_overview.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'pie'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20labels%3Drfm_segments%5B'rfm_segment'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20values%3Drfm_segments%5B'customer_count'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(colors%3Dsegment_colors)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20name%3D'Customers'%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D1%0A%20%20%20%20)%0A%0A%20%20%20%20fig_rfm_overview.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'pie'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20labels%3Drfm_segments%5B'rfm_segment'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20values%3Drfm_segments%5B'total_ltv'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(colors%3Dsegment_colors)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20name%3D'LTV'%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D2%0A%20%20%20%20)%0A%0A%20%20%20%20fig_rfm_overview.update_layout(%0A%20%20%20%20%20%20%20%20title%3D%22RFM%20Segment%20Distribution%22%2C%0A%20%20%20%20%20%20%20%20height%3D500%0A%20%20%20%20)%0A%0A%20%20%20%20fig_rfm_overview%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20RFM%20Score%20Distribution%0A%0A%20%20%20%20Individual%20R%2C%20F%2C%20M%20scores%20across%20the%20customer%20base%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con%2C%20where_clause)%3A%0A%20%20%20%20rfm_score_dist%20%3D%20con.execute(f%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20recency_score%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20frequency_score%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20monetary_score%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20COUNT(DISTINCT%20customer_id)%20as%20customer_count%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20%7Bwhere_clause%7D%0A%20%20%20%20%20%20%20%20GROUP%20BY%20recency_score%2C%20frequency_score%2C%20monetary_score%0A%20%20%20%20%20%20%20%20ORDER%20BY%20recency_score%2C%20frequency_score%2C%20monetary_score%0A%20%20%20%20%22%22%22).df()%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con%2C%20where_clause)%3A%0A%20%20%20%20%23%20Get%20score%20averages%20by%20segment%0A%20%20%20%20score_by_segment%20%3D%20con.execute(f%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20rfm_segment%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(recency_score)%20as%20avg_r%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(frequency_score)%20as%20avg_f%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(monetary_score)%20as%20avg_m%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20%7Bwhere_clause%7D%0A%20%20%20%20%20%20%20%20AND%20rfm_segment%20IS%20NOT%20NULL%0A%20%20%20%20%20%20%20%20GROUP%20BY%20rfm_segment%0A%20%20%20%20%20%20%20%20ORDER%20BY%20(avg_r%20%2B%20avg_f%20%2B%20avg_m)%20DESC%0A%20%20%20%20%22%22%22).df()%0A%20%20%20%20return%20(score_by_segment%2C)%0A%0A%0A%40app.cell%0Adef%20_(go%2C%20score_by_segment)%3A%0A%20%20%20%20fig_rfm_scores%20%3D%20go.Figure()%0A%0A%20%20%20%20fig_rfm_scores.add_trace(go.Bar(%0A%20%20%20%20%20%20%20%20name%3D'Recency%20Score'%2C%0A%20%20%20%20%20%20%20%20x%3Dscore_by_segment%5B'rfm_segment'%5D%2C%0A%20%20%20%20%20%20%20%20y%3Dscore_by_segment%5B'avg_r'%5D%2C%0A%20%20%20%20%20%20%20%20marker_color%3D'%233498db'%0A%20%20%20%20))%0A%0A%20%20%20%20fig_rfm_scores.add_trace(go.Bar(%0A%20%20%20%20%20%20%20%20name%3D'Frequency%20Score'%2C%0A%20%20%20%20%20%20%20%20x%3Dscore_by_segment%5B'rfm_segment'%5D%2C%0A%20%20%20%20%20%20%20%20y%3Dscore_by_segment%5B'avg_f'%5D%2C%0A%20%20%20%20%20%20%20%20marker_color%3D'%232ecc71'%0A%20%20%20%20))%0A%0A%20%20%20%20fig_rfm_scores.add_trace(go.Bar(%0A%20%20%20%20%20%20%20%20name%3D'Monetary%20Score'%2C%0A%20%20%20%20%20%20%20%20x%3Dscore_by_segment%5B'rfm_segment'%5D%2C%0A%20%20%20%20%20%20%20%20y%3Dscore_by_segment%5B'avg_m'%5D%2C%0A%20%20%20%20%20%20%20%20marker_color%3D'%23f39c12'%0A%20%20%20%20))%0A%0A%20%20%20%20fig_rfm_scores.update_layout(%0A%20%20%20%20%20%20%20%20title%3D'Average%20RFM%20Scores%20by%20Segment'%2C%0A%20%20%20%20%20%20%20%20xaxis_title%3D'RFM%20Segment'%2C%0A%20%20%20%20%20%20%20%20yaxis_title%3D'Score%20(1-5)'%2C%0A%20%20%20%20%20%20%20%20barmode%3D'group'%2C%0A%20%20%20%20%20%20%20%20height%3D500%0A%20%20%20%20)%0A%0A%20%20%20%20fig_rfm_scores%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20Customer%20Lifecycle%20Analysis%0A%0A%20%20%20%20Distribution%20across%20lifecycle%20stages%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con)%3A%0A%20%20%20%20lifecycle_data%20%3D%20con.execute(%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20lifecycle_stage%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20COUNT(DISTINCT%20customer_id)%20as%20customer_count%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20SUM(lifetime_value)%20as%20total_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(lifetime_value)%20as%20avg_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(recency_days)%20as%20avg_recency%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(total_orders)%20as%20avg_orders%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(avg_review_score)%20as%20avg_satisfaction%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20GROUP%20BY%20lifecycle_stage%0A%20%20%20%20%20%20%20%20ORDER%20BY%0A%20%20%20%20%20%20%20%20%20%20%20%20CASE%20lifecycle_stage%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'Active%20Repeat'%20THEN%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'Active%20New'%20THEN%202%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'Cooling%20Down'%20THEN%203%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'At%20Risk'%20THEN%204%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'Dormant'%20THEN%205%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'Never%20Purchased'%20THEN%206%0A%20%20%20%20%20%20%20%20%20%20%20%20END%0A%20%20%20%20%22%22%22).df()%0A%0A%20%20%20%20lifecycle_data%0A%20%20%20%20return%20(lifecycle_data%2C)%0A%0A%0A%40app.cell%0Adef%20_(lifecycle_data%2C%20make_subplots)%3A%0A%20%20%20%20fig_lifecycle%20%3D%20make_subplots(%0A%20%20%20%20%20%20%20%20rows%3D2%2C%20cols%3D2%2C%0A%20%20%20%20%20%20%20%20subplot_titles%3D(%0A%20%20%20%20%20%20%20%20%20%20%20%20'Customer%20Count'%2C%20'Total%20Lifetime%20Value'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'Avg%20Orders%20per%20Customer'%2C%20'Avg%20Recency%20(days)'%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20specs%3D%5B%5B%7B'type'%3A%20'bar'%7D%2C%20%7B'type'%3A%20'bar'%7D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B%7B'type'%3A%20'bar'%7D%2C%20%7B'type'%3A%20'bar'%7D%5D%5D%0A%20%20%20%20)%0A%0A%20%20%20%20lifecycle_colors%20%3D%20%7B%0A%20%20%20%20%20%20%20%20'Active%20Repeat'%3A%20'%2327ae60'%2C%0A%20%20%20%20%20%20%20%20'Active%20New'%3A%20'%232ecc71'%2C%0A%20%20%20%20%20%20%20%20'Cooling%20Down'%3A%20'%23f39c12'%2C%0A%20%20%20%20%20%20%20%20'At%20Risk'%3A%20'%23e67e22'%2C%0A%20%20%20%20%20%20%20%20'Dormant'%3A%20'%23e74c3c'%2C%0A%20%20%20%20%20%20%20%20'Never%20Purchased'%3A%20'%2395a5a6'%0A%20%20%20%20%7D%0A%0A%20%20%20%20bar_colors%20%3D%20%5Blifecycle_colors.get(stage%2C%20'%2395a5a6')%20for%20stage%20in%20lifecycle_data%5B'lifecycle_stage'%5D%5D%0A%0A%20%20%20%20fig_lifecycle.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'bar'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dlifecycle_data%5B'lifecycle_stage'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dlifecycle_data%5B'customer_count'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3Dbar_colors)%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D1%0A%20%20%20%20)%0A%0A%20%20%20%20fig_lifecycle.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'bar'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dlifecycle_data%5B'lifecycle_stage'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dlifecycle_data%5B'total_ltv'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3Dbar_colors)%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D2%0A%20%20%20%20)%0A%0A%20%20%20%20fig_lifecycle.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'bar'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dlifecycle_data%5B'lifecycle_stage'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dlifecycle_data%5B'avg_orders'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3Dbar_colors)%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D2%2C%20col%3D1%0A%20%20%20%20)%0A%0A%20%20%20%20fig_lifecycle.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'bar'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dlifecycle_data%5B'lifecycle_stage'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dlifecycle_data%5B'avg_recency'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3Dbar_colors)%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D2%2C%20col%3D2%0A%20%20%20%20)%0A%0A%20%20%20%20fig_lifecycle.update_layout(%0A%20%20%20%20%20%20%20%20title%3D%22Customer%20Lifecycle%20Analysis%22%2C%0A%20%20%20%20%20%20%20%20height%3D700%2C%0A%20%20%20%20%20%20%20%20showlegend%3DFalse%0A%20%20%20%20)%0A%0A%20%20%20%20fig_lifecycle%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20Value%20Tier%20Analysis%0A%0A%20%20%20%20Customer%20segmentation%20by%20lifetime%20value%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con)%3A%0A%20%20%20%20value_tiers%20%3D%20con.execute(%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20value_tier%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20COUNT(DISTINCT%20customer_id)%20as%20customer_count%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20SUM(lifetime_value)%20as%20total_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(lifetime_value)%20as%20avg_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(total_orders)%20as%20avg_orders%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20MIN(lifetime_value)%20as%20min_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20MAX(lifetime_value)%20as%20max_ltv%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20GROUP%20BY%20value_tier%0A%20%20%20%20%20%20%20%20ORDER%20BY%0A%20%20%20%20%20%20%20%20%20%20%20%20CASE%20value_tier%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'VIP'%20THEN%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'High%20Value'%20THEN%202%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'Medium%20Value'%20THEN%203%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'Low%20Value'%20THEN%204%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20WHEN%20'No%20Orders'%20THEN%205%0A%20%20%20%20%20%20%20%20%20%20%20%20END%0A%20%20%20%20%22%22%22).df()%0A%0A%20%20%20%20value_tiers%0A%20%20%20%20return%20(value_tiers%2C)%0A%0A%0A%40app.cell%0Adef%20_(px%2C%20value_tiers)%3A%0A%20%20%20%20%23%20Value%20tier%20contribution%0A%20%20%20%20fig_value_tiers%20%3D%20px.sunburst(%0A%20%20%20%20%20%20%20%20value_tiers%2C%0A%20%20%20%20%20%20%20%20path%3D%5B'value_tier'%5D%2C%0A%20%20%20%20%20%20%20%20values%3D'total_ltv'%2C%0A%20%20%20%20%20%20%20%20color%3D'avg_ltv'%2C%0A%20%20%20%20%20%20%20%20color_continuous_scale%3D'Greens'%2C%0A%20%20%20%20%20%20%20%20title%3D'Revenue%20Contribution%20by%20Value%20Tier'%0A%20%20%20%20)%0A%0A%20%20%20%20fig_value_tiers.update_layout(height%3D600)%0A%20%20%20%20fig_value_tiers%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20RFM%20Segment%20Deep%20Dive%0A%0A%20%20%20%20Detailed%20characteristics%20of%20each%20segment%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con%2C%20where_clause)%3A%0A%20%20%20%20segment_characteristics%20%3D%20con.execute(f%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20rfm_segment%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20COUNT(DISTINCT%20customer_id)%20as%20customers%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(recency_days)%20as%20avg_recency_days%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(frequency)%20as%20avg_frequency%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(monetary_value)%20as%20avg_monetary%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(lifetime_value)%20as%20avg_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(total_orders)%20as%20avg_orders%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(avg_order_value)%20as%20avg_order_value%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(avg_review_score)%20as%20avg_satisfaction%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(on_time_delivery_rate)%20as%20avg_on_time_rate%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20SUM(lifetime_value)%20%2F%20SUM(SUM(lifetime_value))%20OVER%20()%20*%20100%20as%20ltv_contribution_pct%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20%7Bwhere_clause%7D%0A%20%20%20%20%20%20%20%20AND%20rfm_segment%20IS%20NOT%20NULL%0A%20%20%20%20%20%20%20%20GROUP%20BY%20rfm_segment%0A%20%20%20%20%20%20%20%20ORDER%20BY%20ltv_contribution_pct%20DESC%0A%20%20%20%20%22%22%22).df()%0A%0A%20%20%20%20segment_characteristics%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20Reactivation%20Opportunities%0A%0A%20%20%20%20Customers%20at%20risk%20or%20dormant%20that%20could%20be%20targeted%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con)%3A%0A%20%20%20%20reactivation_targets%20%3D%20con.execute(%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20rfm_segment%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20lifecycle_stage%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20COUNT(DISTINCT%20customer_id)%20as%20customer_count%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20SUM(lifetime_value)%20as%20historical_ltv%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(total_orders)%20as%20avg_past_orders%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(recency_days)%20as%20avg_days_since_purchase%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(avg_review_score)%20as%20avg_past_satisfaction%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20WHERE%20rfm_segment%20IN%20('At%20Risk'%2C%20'Lost')%0A%20%20%20%20%20%20%20%20%20%20%20OR%20lifecycle_stage%20IN%20('Cooling%20Down'%2C%20'At%20Risk'%2C%20'Dormant')%0A%20%20%20%20%20%20%20%20GROUP%20BY%20rfm_segment%2C%20lifecycle_stage%0A%20%20%20%20%20%20%20%20ORDER%20BY%20historical_ltv%20DESC%0A%20%20%20%20%22%22%22).df()%0A%0A%20%20%20%20reactivation_targets%0A%20%20%20%20return%20(reactivation_targets%2C)%0A%0A%0A%40app.cell%0Adef%20_(go%2C%20reactivation_targets)%3A%0A%20%20%20%20fig_reactivation%20%3D%20go.Figure()%0A%0A%20%20%20%20fig_reactivation.add_trace(go.Bar(%0A%20%20%20%20%20%20%20%20x%3Dreactivation_targets%5B'rfm_segment'%5D%20%2B%20'%20-%20'%20%2B%20reactivation_targets%5B'lifecycle_stage'%5D%2C%0A%20%20%20%20%20%20%20%20y%3Dreactivation_targets%5B'customer_count'%5D%2C%0A%20%20%20%20%20%20%20%20marker%3Ddict(%0A%20%20%20%20%20%20%20%20%20%20%20%20color%3Dreactivation_targets%5B'historical_ltv'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20colorscale%3D'Reds'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20showscale%3DTrue%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20colorbar%3Ddict(title%3D%22Historical%3Cbr%3ELTV%22)%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20text%3Dreactivation_targets%5B'customer_count'%5D%2C%0A%20%20%20%20%20%20%20%20textposition%3D'outside'%2C%0A%20%20%20%20%20%20%20%20hovertemplate%3D'%3Cb%3E%25%7Bx%7D%3C%2Fb%3E%3Cbr%3ECustomers%3A%20%25%7By%7D%3Cbr%3EHistorical%20LTV%3A%20R%24%20%25%7Bmarker.color%3A%2C.2f%7D%3Cextra%3E%3C%2Fextra%3E'%0A%20%20%20%20))%0A%0A%20%20%20%20fig_reactivation.update_layout(%0A%20%20%20%20%20%20%20%20title%3D%22Reactivation%20Opportunities%20(At%20Risk%20%26%20Lost%20Customers)%22%2C%0A%20%20%20%20%20%20%20%20xaxis_title%3D%22Segment%20-%20Lifecycle%20Stage%22%2C%0A%20%20%20%20%20%20%20%20yaxis_title%3D%22Customer%20Count%22%2C%0A%20%20%20%20%20%20%20%20height%3D600%2C%0A%20%20%20%20%20%20%20%20showlegend%3DFalse%0A%20%20%20%20)%0A%0A%20%20%20%20fig_reactivation.update_xaxes(tickangle%3D45)%0A%20%20%20%20fig_reactivation%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20Geographic%20Distribution%20by%20Segment%0A%0A%20%20%20%20Regional%20presence%20of%20different%20customer%20segments%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con)%3A%0A%20%20%20%20segment_by_region%20%3D%20con.execute(%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20region%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20rfm_segment%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20COUNT(DISTINCT%20customer_id)%20as%20customer_count%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20SUM(lifetime_value)%20as%20total_ltv%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20WHERE%20region%20IS%20NOT%20NULL%0A%20%20%20%20%20%20%20%20AND%20rfm_segment%20IS%20NOT%20NULL%0A%20%20%20%20%20%20%20%20GROUP%20BY%20region%2C%20rfm_segment%0A%20%20%20%20%20%20%20%20ORDER%20BY%20region%2C%20total_ltv%20DESC%0A%20%20%20%20%22%22%22).df()%0A%20%20%20%20return%20(segment_by_region%2C)%0A%0A%0A%40app.cell%0Adef%20_(px%2C%20segment_by_region)%3A%0A%20%20%20%20fig_region_segment%20%3D%20px.bar(%0A%20%20%20%20%20%20%20%20segment_by_region%2C%0A%20%20%20%20%20%20%20%20x%3D'region'%2C%0A%20%20%20%20%20%20%20%20y%3D'customer_count'%2C%0A%20%20%20%20%20%20%20%20color%3D'rfm_segment'%2C%0A%20%20%20%20%20%20%20%20title%3D'Customer%20Segments%20by%20Region'%2C%0A%20%20%20%20%20%20%20%20labels%3D%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20'region'%3A%20'Region'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'customer_count'%3A%20'Customer%20Count'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'rfm_segment'%3A%20'RFM%20Segment'%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20height%3D600%2C%0A%20%20%20%20%20%20%20%20barmode%3D'stack'%0A%20%20%20%20)%0A%0A%20%20%20%20fig_region_segment%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20Customer%20Behavior%20Patterns%0A%0A%20%20%20%20Purchase%20and%20review%20behavior%20by%20segment%3A%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(con%2C%20where_clause)%3A%0A%20%20%20%20behavior_patterns%20%3D%20con.execute(f%22%22%22%0A%20%20%20%20%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20%20%20%20%20rfm_segment%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(avg_days_between_orders)%20as%20avg_repurchase_cycle%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(avg_items_per_order)%20as%20avg_basket_size%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(installment_orders)%20%2F%20NULLIF(AVG(total_orders)%2C%200)%20*%20100%20as%20installment_rate%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(orders_with_comments)%20%2F%20NULLIF(AVG(total_orders)%2C%200)%20*%20100%20as%20comment_rate%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20AVG(unique_categories_purchased)%20as%20avg_categories%0A%20%20%20%20%20%20%20%20FROM%20marts_customer.mart_customer_analytics%0A%20%20%20%20%20%20%20%20%7Bwhere_clause%7D%0A%20%20%20%20%20%20%20%20AND%20rfm_segment%20IS%20NOT%20NULL%0A%20%20%20%20%20%20%20%20GROUP%20BY%20rfm_segment%0A%20%20%20%20%20%20%20%20ORDER%20BY%20avg_repurchase_cycle%0A%20%20%20%20%22%22%22).df()%0A%20%20%20%20return%20(behavior_patterns%2C)%0A%0A%0A%40app.cell%0Adef%20_(behavior_patterns%2C%20make_subplots)%3A%0A%20%20%20%20fig_behavior%20%3D%20make_subplots(%0A%20%20%20%20%20%20%20%20rows%3D2%2C%20cols%3D2%2C%0A%20%20%20%20%20%20%20%20subplot_titles%3D(%0A%20%20%20%20%20%20%20%20%20%20%20%20'Avg%20Repurchase%20Cycle%20(days)'%2C%20'Avg%20Basket%20Size%20(items)'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20'Installment%20Usage%20Rate%20(%25)'%2C%20'Avg%20Categories%20Purchased'%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20specs%3D%5B%5B%7B'type'%3A%20'bar'%7D%2C%20%7B'type'%3A%20'bar'%7D%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5B%7B'type'%3A%20'bar'%7D%2C%20%7B'type'%3A%20'bar'%7D%5D%5D%0A%20%20%20%20)%0A%0A%20%20%20%20fig_behavior.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'bar'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dbehavior_patterns%5B'rfm_segment'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dbehavior_patterns%5B'avg_repurchase_cycle'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'%233498db')%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D1%0A%20%20%20%20)%0A%0A%20%20%20%20fig_behavior.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'bar'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dbehavior_patterns%5B'rfm_segment'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dbehavior_patterns%5B'avg_basket_size'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'%232ecc71')%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D1%2C%20col%3D2%0A%20%20%20%20)%0A%0A%20%20%20%20fig_behavior.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'bar'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dbehavior_patterns%5B'rfm_segment'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dbehavior_patterns%5B'installment_rate'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'%23f39c12')%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D2%2C%20col%3D1%0A%20%20%20%20)%0A%0A%20%20%20%20fig_behavior.add_trace(%0A%20%20%20%20%20%20%20%20dict(%0A%20%20%20%20%20%20%20%20%20%20%20%20type%3D'bar'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dbehavior_patterns%5B'rfm_segment'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dbehavior_patterns%5B'avg_categories'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20marker%3Ddict(color%3D'%239b59b6')%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20row%3D2%2C%20col%3D2%0A%20%20%20%20)%0A%0A%20%20%20%20fig_behavior.update_layout(%0A%20%20%20%20%20%20%20%20title%3D%22Customer%20Behavior%20Patterns%20by%20RFM%20Segment%22%2C%0A%20%20%20%20%20%20%20%20height%3D700%2C%0A%20%20%20%20%20%20%20%20showlegend%3DFalse%0A%20%20%20%20)%0A%0A%20%20%20%20fig_behavior.update_xaxes(tickangle%3D45)%0A%20%20%20%20fig_behavior%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20---%0A%20%20%20%20%23%23%20Key%20Insights%20%26%20Recommendations%0A%0A%20%20%20%20**Segment%20Strategies%3A**%0A%0A%20%20%20%20**Champions**%20(High%20R%2C%20F%2C%20M)%0A%20%20%20%20-%20Reward%20with%20exclusive%20perks%20and%20early%20access%0A%20%20%20%20-%20Use%20as%20brand%20ambassadors%0A%20%20%20%20-%20Maintain%20high%20service%20quality%0A%0A%20%20%20%20**Loyal%20Customers**%20(Good%20R%2C%20F%2C%20M)%0A%20%20%20%20-%20Upsell%20and%20cross-sell%20opportunities%0A%20%20%20%20-%20Encourage%20referrals%0A%20%20%20%20-%20Build%20long-term%20relationships%0A%0A%20%20%20%20**Big%20Spenders**%20(High%20M%2C%20varying%20R%2C%20F)%0A%20%20%20%20-%20VIP%20treatment%20and%20personalized%20service%0A%20%20%20%20-%20Premium%20product%20recommendations%0A%20%20%20%20-%20Special%20pricing%20or%20bundles%0A%0A%20%20%20%20**New%20Customers**%20(High%20R%2C%20low%20F)%0A%20%20%20%20-%20Welcome%20programs%20and%20onboarding%0A%20%20%20%20-%20Product%20education%0A%20%20%20%20-%20Incentivize%20second%20purchase%0A%0A%20%20%20%20**At%20Risk**%20(Low%20R%2C%20high%20F)%0A%20%20%20%20-%20Win-back%20campaigns%20with%20special%20offers%0A%20%20%20%20-%20Survey%20for%20feedback%0A%20%20%20%20-%20Remind%20of%20past%20positive%20experiences%0A%0A%20%20%20%20**Lost**%20(Very%20low%20R)%0A%20%20%20%20-%20Aggressive%20reactivation%20campaigns%0A%20%20%20%20-%20Significant%20discounts%20or%20promotions%0A%20%20%20%20-%20Understand%20reasons%20for%20churn%0A%0A%20%20%20%20**Regular**%20(Average%20scores)%0A%20%20%20%20-%20Nurture%20with%20consistent%20engagement%0A%20%20%20%20-%20Move%20up%20to%20Loyal%20or%20Champions%0A%20%20%20%20-%20Prevent%20downgrade%20to%20At%20Risk%0A%20%20%20%20%22%22%22)%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">5ee4872faf39aff47085ab9ad67e4d67</marimo-code-hash>
</body>
</html>
