repos:
  # SQLFluff for SQL linting and formatting
  - repo: https://github.com/sqlfluff/sqlfluff
    rev: 3.5.0
    hooks:
      - id: sqlfluff-lint
        name: SQLFluff Lint
        files: \.sql$
        # Only run on dbt models
        exclude: ^(dbt/olist_dw_dbt/target/|dbt/olist_dw_dbt/dbt_packages/)
        args: ["--config", "dbt/olist_dw_dbt/.sqlfluff"]
        additional_dependencies: ['dbt-duckdb', 'sqlfluff-templater-dbt']

      - id: sqlfluff-fix
        name: SQLFluff Fix
        files: \.sql$
        # Only run on dbt models
        exclude: ^(dbt/olist_dw_dbt/target/|dbt/olist_dw_dbt/dbt_packages/)
        args: ["--config", "dbt/olist_dw_dbt/.sqlfluff"]
        additional_dependencies: ['dbt-duckdb', 'sqlfluff-templater-dbt']

  # dbt-checkpoint for dbt-specific validations
  - repo: https://github.com/dbt-checkpoint/dbt-checkpoint
    rev: v2.0.5
    hooks:
      # Check model has description (will enable in Week 2 after all docs complete)
      # - id: check-model-has-description
      #   name: Check model has description
      #   files: ^dbt/olist_dw_dbt/
      #   args: ["--manifest", "dbt/olist_dw_dbt/target/manifest.json", "--"]

      # Check model has at least one test (will enable in Week 2 with dbt-expectations)
      # - id: check-model-has-tests
      #   name: Check model has tests
      #   files: ^dbt/olist_dw_dbt/
      #   args: ["--test-cnt", "1", "--manifest", "dbt/olist_dw_dbt/target/manifest.json", "--"]

      # Check column names are lowercase with underscores (will enable in Week 2)
      # - id: check-column-name-contract
      #   name: Check column names are lowercase
      #   files: ^dbt/olist_dw_dbt/
      #   args: ["--pattern", "^[a-z_][a-z0-9_]*$", "--dtypes", "text", "integer", "bigint", "double", "timestamp", "date", "boolean", "varchar", "--manifest", "dbt/olist_dw_dbt/target/manifest.json", "--catalog", "dbt/olist_dw_dbt/target/catalog.json", "--"]

      # Check model naming conventions (stg_, int_, dim_, fct_, mart_)
      - id: check-model-name-contract
        name: Check model naming conventions
        files: ^dbt/olist_dw_dbt/models/
        args:
          - "--pattern"
          - "^(stg|int|dim|fct|mart|my)_[a-z0-9_]+$"
          - "--manifest"
          - "dbt/olist_dw_dbt/target/manifest.json"
          - "--"

      # Check sources have freshness checks
      - id: check-source-has-freshness
        name: Check sources have freshness
        files: ^dbt/olist_dw_dbt/
        args: ["--freshness", "error_after", "warn_after", "--manifest", "dbt/olist_dw_dbt/target/manifest.json", "--"]

      # Check sources have loader defined
      - id: check-source-has-loader
        name: Check sources have loader
        files: ^dbt/olist_dw_dbt/
        args: ["--manifest", "dbt/olist_dw_dbt/target/manifest.json", "--"]

      # Check sources have tests
      - id: check-source-has-tests
        name: Check sources have tests
        files: ^dbt/olist_dw_dbt/
        args: ["--test-cnt", "1", "--manifest", "dbt/olist_dw_dbt/target/manifest.json", "--"]

      # Generate missing documentation
      - id: generate-missing-sources
        name: Generate missing source definitions
        files: ^dbt/olist_dw_dbt/
        args: ["--schema-file", "models/staging/sources.yml", "--manifest", "dbt/olist_dw_dbt/target/manifest.json", "--"]

  # General pre-commit hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
      - id: end-of-file-fixer
        name: Fix end of files
      - id: check-yaml
        name: Check YAML syntax
        exclude: ^dbt/olist_dw_dbt/target/
      - id: check-added-large-files
        name: Check for large files
        args: ['--maxkb=1000']
      - id: check-case-conflict
        name: Check for case conflicts
      - id: check-merge-conflict
        name: Check for merge conflicts
      - id: detect-private-key
        name: Detect private keys

  # Python code formatting (for .py files like marimo notebooks)
  - repo: https://github.com/psf/black
    rev: 24.10.0
    hooks:
      - id: black
        name: Format Python code with Black
        language_version: python3.10

  # Python import sorting
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        name: Sort Python imports
        args: ["--profile", "black"]
